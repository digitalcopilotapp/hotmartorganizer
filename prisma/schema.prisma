// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["postgresqlExtensions"]
  binaryTargets = ["debian-openssl-1.1.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  extensions = [vector]
}

model Contact {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  phone     String?
  country   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relações
  sales     Sale[]
  embedding Embedding?

  @@map("contacts")
}

model Sale {
  id              Int      @id @default(autoincrement())
  transaction     String   @unique
  productName     String
  productId       Int
  priceValue      Float
  currency        String
  status          String
  purchaseDate    DateTime
  
  contactId       Int
  contact         Contact  @relation(fields: [contactId], references: [id])

  createdAt       DateTime @default(now())
  
  @@map("sales")
}

model Embedding {
  id        Int                    @id @default(autoincrement())
  vector    Unsupported("vector")? // Vetor de dimensão variável (ex: 1536 para OpenAI)
  
  contactId Int      @unique
  contact   Contact  @relation(fields: [contactId], references: [id])
  
  @@map("embeddings")
}

model Log {
  id        Int      @id @default(autoincrement())
  level     String   // INFO, ERROR, WARN
  message   String
  context   Json?
  createdAt DateTime @default(now())

  @@map("logs")
}
